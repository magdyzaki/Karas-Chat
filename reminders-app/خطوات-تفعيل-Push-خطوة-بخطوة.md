# خطوات تفعيل التنبيه مع الشاشة مطفية — خطوة بخطوة

---

## الجزء الأول: رفع ملف واحد (index.js)

1. افتح على جهازك الملف: **reminders-app\backend\index.js**
2. انسخ **كل** محتوى الملف (Ctrl+A ثم Ctrl+C).
3. ادخل **GitHub** → مستودع **reminders-backend** (magdyzaki/reminders-backend).
4. اضغط على الملف **index.js** (في الجذر).
5. اضغط زر **Edit** (أيقونة القلم).
6. احذف المحتوى القديم بالكامل (Ctrl+A ثم Delete) والصق المحتوى الذي نسخته من جهازك.
7. انزل لأسفل الصفحة واضغط **Commit changes**.
8. انتهى الجزء الأول.

---

## الجزء الثاني: إضافة متغير وكلمة مرور في Koyeb

1. ادخل **koyeb.com** وسجّل الدخول.
2. من القائمة اختر خدمة **reminders-backend** (أو الاسم الذي يظهر لك).
3. من أعلى أو جانب الصفحة اضغط **Settings**.
4. داخل الإعدادات ابحث عن قسم **Environment** أو **Environment Variables** واضغط عليه.
5. اضغط **Add variable** أو **Add environment variable**.
6. في **Name** اكتب بالضبط: **CRON_SECRET**
7. في **Value** اكتب كلمة مرور جديدة طويلة (مثلاً 15 حرف أو أكثر)، مثال: **RemindersCron2026Secret**
   - يمكنك استخدام أحرف وأرقام فقط، أو توليد كلمة عشوائية وحفظها عندك.
8. احفظ (Save).
9. من صفحة الخدمة اضغط **Redeploy** واختر **Create build** ثم نفّذ، وانتظر حتى يصبح **Running** أو **Healthy**.
10. انتهى الجزء الثاني.

**ملاحظة:** احفظ قيمة **CRON_SECRET** (كلمة المرور التي وضعتها) عندك؛ ستحتاجها في الخطوة التالية.

---

## الجزء الثالث: إعداد الكرون (cron-job.org)

1. افتح المتصفح وادخل الموقع: **https://cron-job.org**
2. سجّل الدخول أو أنشئ حساباً مجانياً (Sign up).
3. من لوحة التحكم اضغط **Create cron job** أو **Create** ثم **Cron job**.
4. املأ الحقول:
   - **Title:** اكتب مثلاً **Reminders Push** (أي اسم لتذكر المهمة).
   - **URL:**  
     اكتب الرابط بالكامل مع كلمة السر التي وضعتها في Koyeb، بالشكل التالي:  
     **https://southern-winonah-elraee-ae4bfbd7.koyeb.app/api/push/check?secret=كلمة_السر**  
     استبدل **كلمة_السر** بقيمة **CRON_SECRET** التي حفظتها (مثال: إذا كانت `RemindersCron2026Secret` ف الرابط يصبح:  
     `https://southern-winonah-elraee-ae4bfbd7.koyeb.app/api/push/check?secret=RemindersCron2026Secret`).
   - **Schedule / Interval:** اختر **Every minute** أو **كل دقيقة** (أو كل 2 دقائق إذا لم يتوفر كل دقيقة).
5. احفظ المهمة (Save / Create).
6. تأكد أن المهمة **مفعّلة** (Enabled).
7. انتهى الجزء الثالث.

---

## التحقق

- بعد دقائق، يمكنك فتح الرابط في المتصفح (بنفس الرابط الذي وضعته في الكرون)؛ يفترض أن ترى رداً مثل: **{"ok":true,"message":"تم فحص التنبيهات"}**.
- جرّب من الموبايل: أضف تنبيهاً بعد دقيقتين، اطفئ الشاشة، وانتظر حتى بعد الموعد بدقيقة — يفترض أن يصل الإشعار.
