# تخزين التنبيهات دائماً على Koyeb (حتى لا تُحذف)

أنت تستخدم **GitHub** + **Koyeb** (سيرفر التنبيهات) + **Vercel** (واجهة التنبيهات).  
بدون الخطوة التالية، Koyeb يخزّن قاعدة البيانات في **مجلد مؤقت** يُمسح عند إعادة التشغيل أو نوم الخدمة (Scale to Zero)، فتُفقد كل التنبيهات والمستخدمين.

---

## الحل: Volume + متغير DB_PATH على Koyeb

### ملاحظة مهمة عن خطة Koyeb

- **Volumes** (الأقراص الثابتة) على Koyeb تعمل حالياً مع الخدمات من نوع **Standard** أو **GPU** فقط، و**لا تعمل** مع خطط **Free** أو **Eco** ([توثيق Koyeb Volumes](https://www.koyeb.com/docs/reference/volumes)).
- إذا كانت خدمتك على الخطة المجانية (Free/Eco)، لديك خياران:
  1. **ترقية** الخدمة إلى Standard ثم إضافة Volume كما below، أو  
  2. استخدام **قاعدة بيانات خارجية** (مثل MongoDB Atlas مجاني) وتعديل الكود ليقرأ/يكتب منها — وهذا يتطلب تغييراً في الكود.

الخطوات التالية تفترض أنك تستخدم خدمة يمكن ربط Volume بها (Standard أو ما يعادلها).

---

## الخطوة 1: إنشاء Volume على Koyeb

1. ادخل **https://app.koyeb.com** وسجّل الدخول.
2. من القائمة الجانبية أو من **Volumes** اضغط **Create volume** (أو من [Volumes](https://app.koyeb.com/volumes)).
3. اختر:
   - **Name:** مثلاً `reminders-data`
   - **Size:** 1 GB (كافي للتنبيهات والمستخدمين).
   - **Region:** يجب أن تكون **نفس منطقة خدمتك** (مثلاً Washington `was` أو Frankfurt `fra` — Volumes متوفرة في هاتين المنطقتين حالياً).
4. احفظ (Create).

---

## الخطوة 2: ربط الـ Volume بالخدمة

1. ادخل إلى **Services** وافتح خدمة التنبيهات (مثلاً **reminders-backend**).
2. من **Settings** أو من تبويب الخدمة ابحث عن **Volumes** أو **Storage**.
3. **اربط (Attach)** الـ Volume الذي أنشأته بالخدمة، واختر **Mount path** (مسار الربط)، مثلاً: **/data**  
   — لو الواجهة تطلب مساراً فقط بدون اسم ملف، استخدم **/data**.
4. تأكد أن **Scale** للخدمة = **1** (Volumes على Koyeb تعمل فقط مع scale واحد).
5. احفظ التعديلات. قد تحتاج إلى **Redeploy** حتى يظهر المسار الجديد.

---

## الخطوة 3: ضبط متغير البيئة DB_PATH

1. في نفس الخدمة على Koyeb ادخل **Settings** → **Environment** (أو **Environment variables**).
2. أضف متغيراً جديداً:
   - **Key:** `DB_PATH`
   - **Value:** `/data/reminders-db.json`  
     (إذا كان مسار الربط مختلفاً، غيّر الجزء `/data` ليتطابق مع الـ Mount path اللي اخترته.)
3. احفظ (Save).

---

## الخطوة 4: إعادة النشر

1. من الخدمة اختر **Redeploy** (أو Deploy latest commit).
2. انتظر حتى تكتمل العملية وتصبح الخدمة **Running**.

بعد ذلك السيرفر يكتب قاعدة البيانات في الملف **/data/reminders-db.json** على الـ Volume، والبيانات تبقى حتى بعد إعادة التشغيل أو نوم الخدمة.

---

## كيف تتأكد أن المشكلة اتحلت؟

- من **Logs** في Koyeb: بعد Redeploy، لو **لم يعد** يظهر التحذير التالي فمعناه أن **DB_PATH** مضبوط:
  - `*** تحذير: DB_PATH غير مضبوط. البيانات ... ستُفقد عند إعادة تشغيل السيرفر ***`
- **اختبار عملي:** أضف تنبيهاً (مثلاً بعد أسبوع)، اعمل **Redeploy** من Koyeb، ثم افتح التطبيق وسجّل الدخول — المفروض تشوف نفس التنبيه والقائمة كما كانت.

تفاصيل إضافية في **كيف-تعرف-أن-المشكلة-اتحلت.md**.
