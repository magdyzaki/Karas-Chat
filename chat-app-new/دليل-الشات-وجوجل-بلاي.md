# دليل برنامج الشات — المجلد الرسمي والتجهيز لجوجل بلاي

---

## 1) المجلد الرسمي لبرنامج الشات

### المسار الكامل

```
D:\programs\Smart_CRM_Final_Arabic\chat-app-new
```

### الهيكل

| المجلد/الملف | الوصف |
|--------------|--------|
| **frontend/** | الواجهة (React/Vite) — ما يراه المستخدم |
| **backend/** | الباكند (Node/Express + Socket.io) — السيرفر والـ API |
| **google-play/** | تجهيز التطبيق لأندرويد وجوجل بلاي |
| **خطوات-النشر.md** | خطوات النشر على Koyeb و Vercel |

---

## 2) إنشاء نسخة احتياطية

```powershell
Compress-Archive -Path "D:\programs\Smart_CRM_Final_Arabic\chat-app-new" -DestinationPath "D:\backup\chat-app-new-$(Get-Date -Format 'yyyy-MM-dd').zip"
```

غيّر `D:\backup\` حسب مكان الحفظ.

---

## 3) تجهيز ملف AAB للرفع على جوجل بلاي

### المتطلبات

- **Node.js** مثبت
- **Android Studio** مثبت
- حساب مطوّر جوجل بلاي (دفع 25 دولار مرة واحدة)
- رابط الباكند على Koyeb (مثل: `https://karas-chat-xxx.koyeb.app`)

---

### الخطوة 1: ضبط رابط الباكند

أنشئ ملف `.env` في مجلد الواجهة:

**المسار:** `D:\programs\Smart_CRM_Final_Arabic\chat-app-new\frontend\.env`

**المحتوى:**

```
VITE_API_URL=https://رابط-الباكند-على-Koyeb
```

مثال: `VITE_API_URL=https://karas-chat-xxxxx.koyeb.app`

بدون `/` في النهاية.

#### (اختياري) تفعيل المكالمات على باقة الإنترنت

إذا كانت المكالمات لا تعمل إلا على الـ Wi‑Fi وتفشل على باقة الموبايل، تحتاج خادم **TURN** لاجتياز NAT. أضف في نفس `.env`:

```
VITE_TURN_URI=turn:your-turn-server.com:3478
VITE_TURN_USERNAME=اسم_المستخدم
VITE_TURN_CREDENTIAL=كلمة_المرور
```

يمكنك الحصول على TURN مجاني أو مدفوع من:
- **Metered.ca** — طبقة مجانية محدودة
- **Twilio** — رصيد مجاني للتجربة
- **Xirsys** — خطة مجانية

---

### الخطوة 2: بناء الواجهة

```powershell
cd D:\programs\Smart_CRM_Final_Arabic\chat-app-new\frontend
npm install
npm run build
```

يُنشئ مجلد `dist` داخل `frontend`.

---

### الخطوة 3: تجهيز مشروع أندرويد (Capacitor)

```powershell
cd D:\programs\Smart_CRM_Final_Arabic\chat-app-new\google-play
npm install
npx cap add android
npx cap sync android
```

- `cap add android` ينشئ مجلد `android` (أول مرة فقط).
- `cap sync android` ينسخ محتويات `frontend/dist` إلى مشروع أندرويد.

---

### الخطوة 4: فتح المشروع في Android Studio

```powershell
cd D:\programs\Smart_CRM_Final_Arabic\chat-app-new\google-play
npx cap open android
```

---

### الخطوة 5: بناء ملف AAB للرفع

داخل **Android Studio**:

1. من القائمة: **Build** → **Generate Signed Bundle / APK**
2. اختر **Android App Bundle** ثم **Next**
3. إن لم يكن لديك مفتاح توقيع:
   - اختر **Create new**
   - حدد مسار حفظ المفتاح، كلمة مرور، وبيانات الشهادة (الاسم، المنظمة، إلخ)
   - **احفظ المفتاح في مكان آمن** — ستحتاجه لكل تحديث مستقبلي
4. اختر المفتاح ثم **Next**
5. اختَر **release** ثم **Finish**

سيُنتج ملف مثل:

```
chat-app-new\google-play\android\app\release\app-release.aab
```

---

### الخطوة 6: رفع التطبيق على جوجل بلاي

1. ادخل **https://play.google.com/console**
2. أنشئ تطبيقاً جديداً أو اختر تطبيقاً موجوداً
3. من **الإنتاج** أو **الاختبار** → **إنشاء إصدار جديد**
4. ارفع ملف **app-release.aab**
5. أكمل البيانات المطلوبة:
   - الوصف القصير والطويل
   - لقطات شاشة (2–8 صور)
   - أيقونة التطبيق (512×512)
   - سياسة الخصوصية (رابط)
   - تصنيف المحتوى
6. أرسل للمراجعة

---

## ملخص المسارات

| ماذا | أين |
|------|-----|
| المجلد الرسمي للشات | `D:\programs\Smart_CRM_Final_Arabic\chat-app-new` |
| الواجهة | `chat-app-new\frontend` |
| الباكند | `chat-app-new\backend` |
| تجهيز أندرويد | `chat-app-new\google-play` |
| ملف AAB بعد البناء | `chat-app-new\google-play\android\app\release\app-release.aab` |

---

## تحديث التطبيق لاحقاً

1. عدّل الكود في `chat-app-new\frontend`
2. عدّل رقم الإصدار في `google-play\package.json` (مثلاً `"version":"1.0.1"`)
3. نفّذ: بناء الواجهة → cap sync → فتح Android Studio → Generate Signed Bundle
4. ارفع الـ AAB الجديد في Play Console كإصدار جديد
